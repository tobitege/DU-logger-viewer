{"slots":{"1":{"class":"DataBankUnit","type":{"events":[],"methods":[]}},"-5":{"name":"library","type":{"events":[],"methods":[]}},"-4":{"name":"system","type":{"events":[],"methods":[]}},"-3":{"name":"player","type":{"events":[],"methods":[]}},"-2":{"name":"construct","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}}},"handlers":[{"key":1,"filter":{"slotKey":-5,"signature":"onStart()","args":[]},"code":";(function()\nlocal a={}local b=0;function library.addEventHandlers(c)if not c or c.onEvent and c.triggerEvent then return false end;b=b+1;a[b]=c;local d,e,f='table','function','thread'if d~=type(c)then error('You can only add event handlers to table objects!')end;local g={}local function h(c)local i=type(c)return e==i or d==i and h(getmetatable(c).__call)or f==i end;c.onEvent=function(self,j,k,l)if not h(k)then error('Event handler must be a function, a callable object or a thread!')end;l=l or self;if d~=type(l)then error('The value of self must be a table!')end;if not g[j]then g[j]={_=0}end;local m=f==type(k)and function(...)coroutine.resume(k,...)end or k;local k=g[j]local n=k._+1;k[n]={m,l}k._=n;return n end;c.clearEvent=function(self,j,o)if g[j]and g[j][o]then g[j][o]=nil end end;c.clearAllEvents=function(self)g={}end;c.triggerEvent=function(self,j,...)local p=g[j]if p then for q=1,p._ do local k=p[q]if k then k[1](k[2],...)end end end end;return true end;function library.clearAllEventHandlers()for q=1,b do local c=a[q]if c and c.clearAllEvents then c:clearAllEvents()end end end\nend)()"},{"key":2,"filter":{"slotKey":-5,"signature":"onStart()","args":[]},"code":";(function()\nlocal a=DULibrary or{}function a.getLinks(b,c)local d={}if not b then b={}end;for e,f in pairs(unit.getOutPlugs())do local g=unit[f.name]if'table'==type(g)and'function'==type(g.getClass)then local h=true;for i,j in pairs(b)do if not('function'==type(g[i])and j==g[i]():sub(1,#j))then h=false;break end end;if h then if c then table.insert(d,g)else d[f.name]=g end end end end;return d end;function a.getLinksByClass(k,c)return a.getLinks({getClass=k},c)end;function a.getLinkByClass(k)return a.getLinksByClass(k,true)[1]end;function a.getCoreUnit()return a.getLinkByClass('CoreUnit')end;function a.getLinkByName(l)local m=a.getCoreUnit()if not m then error('getLinkByName requires a linked CoreUnit to work')end;local d=a.getLinks()for n,o in pairs(d)do if l==m.getElementNameById(o.getLocalId())then return o end end end\nend)()"},{"key":3,"filter":{"slotKey":-5,"signature":"onStart()","args":[]},"code":"package.preload['DU-logger-viewer:globals.lua']=(function()\n-- Initialize globals and constants\nConfig = { core = nil, c_required=true, databanks = {}, db_required=true, screens = {}, s_required=true }\nDEBUG = true\nINGAME = system ~= nil\n\nif not INGAME then\n\n    function traceback(o)\n        if o then P(tostring(o)) end\n    end\nelse\n    --require 'mockfuncs'\n    print=system.print\nend\nP=print\nend)\npackage.preload['DU-logger-viewer:startup.lua']=(function()\n-- startup for initial config like slots detection\nlocal status, err=false,nil\nif INGAME then\n    ---@diagnostic disable-next-line: undefined-global\n    status, err, _ = xpcall(function()\n        if Config.c_required then\n            Config.core = library.getCoreUnit()\n        end\n        if Config.db_required then\n            Config.databanks = library.getLinksByClass('DataBank', true) -- true is important!\n        end\n        if Config.s_required then\n            Config.screens = library.getLinksByClass('Screen', true)\n        end\n    end, traceback)\n    if not status then\n        P(\"Error in Link Detection:\\n\" .. err)\n        unit.exit()\n        return\n    end\nelse\n    -- use mocks\n    Config.core = unit.core\n    Config.databanks =  { unit.databank }\n    Config.screens =  { unit.screen }\nend\n\nif #Config.databanks > 0 then\n    local plural = \"\"\n    if #Config.databanks > 1 then plural = \"s\" else plural = \" '\"..Config.databanks[1].getName()..\"'\" end\n    P(#Config.databanks .. \" databank\" .. plural .. \" connected.\")\nelse\n    P(\"[E] DataBank not found.\")\nend\nif #Config.screens > 0 then\n    local plural = \"\"\n    if #Config.screens > 1 then plural = \"s\" end\n    P(#Config.screens .. \" screen\" .. plural .. \" connected.\")\nend\nend)\npackage.preload['DU-logger-viewer:viewer-screen.OnOutputChanged.lua']=(function()\nlocal hasData = false\nlocal screenoutput = Screen.getScriptOutput()\nlocal screeninput = \"\"\nif screenoutput == \"\" then\n    screeninput = \"?\"\nelse\n    if screenoutput == \"<\" then -- previous key        \n        if Page > 1 then\n            Page = Page - 1\n            if DBKeys[Page] and Databank.hasKey(DBKeys[Page]) then\n                screeninput = \"KEY:\"..DBKeys[Page]\n            end\n        end\n    elseif screenoutput == \">\" then -- next key\n        if Page < NBKeys then\n            Page = Page + 1\n            if DBKeys[Page] and Databank.hasKey(DBKeys[Page]) then\n                screeninput = \"KEY:\"..DBKeys[Page]\n            end\n        end\n    elseif screenoutput == \"KEYOK\" then -- key accepted, send val now        \n        if DBKeys[Page] and Databank.hasKey(DBKeys[Page]) then\n            screeninput = \"VAL:\"..Databank.getStringValue(DBKeys[Page])\n            hasData = true\n        end\n    else\n        --command not understood\n    end\nend\nScreen.setScriptInput(screeninput)\nScreen.clearScriptOutput()\nif DEBUG then\n    P(\"Screen OUT: \"..screenoutput)\n    local out = \"Screen IN: \"\n    if hasData then\n        out = out .. \"***\"\n    else\n        out = out .. screeninput\n    end\n    P(out)\nend\nend)\npackage.preload['DU-logger-viewer:viewer-main.lua']=(function()\n-- Main viewer script. Assumes Databank and Screen were already assigned!\nPage = 1\nlocal out = \"\"\nNBKeys = Databank.getNbKeys()\nif not NBKeys then\n    P(\"[E] Databank is empty!\")\nelse\n    DBKeys = Databank.getKeyList()\n    if DBKeys and #DBKeys > 0 then\n        local hasKeys = true\n        if #DBKeys == 1 then\n            P(\"1 entry found.\")\n        else\n            P(#DBKeys..\" entries found.\")\n        end\n        -- get first key+value to send to screen\n        for k,v in ipairs(DBKeys) do\n            if DEBUG then P(\"Player ID \"..v..\" found.\") end\n            if out == \"\" then\n                out = \"KEY:\"..tostring(v)\n            end\n        end\n    end\nend\nScreen.activate()\nlocal screenoutput = Screen.getScriptOutput()\nlocal screeninput = out\nScreen.setScriptInput(screeninput)\nScreen.clearScriptOutput()\nif DEBUG then\n    P(\"Screen OUT: \" .. screenoutput)\n    P(\"Screen IN: \" .. screeninput)\nend\nend)"},{"key":4,"filter":{"slotKey":-5,"signature":"onStart()","args":[]},"code":"library.addEventHandlers(library)\nlibrary.addEventHandlers(system)\nlibrary.addEventHandlers(player)\nlibrary.addEventHandlers(construct)\nlibrary.addEventHandlers(unit)\nlibrary.addEventHandlers(undefined)"},{"key":5,"filter":{"slotKey":-4,"signature":"onActionStart(action)","args":[{"variable":"*"}]},"code":"system:triggerEvent('onActionStart',action)"},{"key":6,"filter":{"slotKey":-4,"signature":"onActionLoop(action)","args":[{"variable":"*"}]},"code":"system:triggerEvent('onActionLoop',action)"},{"key":7,"filter":{"slotKey":-4,"signature":"onActionStop(action)","args":[{"variable":"*"}]},"code":"system:triggerEvent('onActionStop',action)"},{"key":8,"filter":{"slotKey":-4,"signature":"onUpdate()","args":[]},"code":"system:triggerEvent('onUpdate')"},{"key":9,"filter":{"slotKey":-4,"signature":"onFlush()","args":[]},"code":"system:triggerEvent('onFlush')"},{"key":10,"filter":{"slotKey":-4,"signature":"onInputText(text)","args":[{"variable":"*"}]},"code":"system:triggerEvent('onInputText',text)"},{"key":11,"filter":{"slotKey":-4,"signature":"onCameraChanged(mode)","args":[{"variable":"*"}]},"code":"system:triggerEvent('onCameraChanged',mode)"},{"key":12,"filter":{"slotKey":-3,"signature":"onParentChanged(oldId,newId)","args":[{"variable":"*"},{"variable":"*"}]},"code":"player:triggerEvent('onParentChanged',oldId,newId)"},{"key":13,"filter":{"slotKey":-2,"signature":"onDocked(id)","args":[{"variable":"*"}]},"code":"construct:triggerEvent('onDocked',id)"},{"key":14,"filter":{"slotKey":-2,"signature":"onUndocked(id)","args":[{"variable":"*"}]},"code":"construct:triggerEvent('onUndocked',id)"},{"key":15,"filter":{"slotKey":-2,"signature":"onPlayerBoarded(id)","args":[{"variable":"*"}]},"code":"construct:triggerEvent('onPlayerBoarded',id)"},{"key":16,"filter":{"slotKey":-2,"signature":"onVRStationEntered(id)","args":[{"variable":"*"}]},"code":"construct:triggerEvent('onVRStationEntered',id)"},{"key":17,"filter":{"slotKey":-2,"signature":"onConstructDocked(id)","args":[{"variable":"*"}]},"code":"construct:triggerEvent('onConstructDocked',id)"},{"key":18,"filter":{"slotKey":-2,"signature":"onPvPTimer(active)","args":[{"variable":"*"}]},"code":"construct:triggerEvent('onPvPTimer',active)"},{"key":19,"filter":{"slotKey":-1,"signature":"onStop()","args":[]},"code":"unit:triggerEvent('onStop')"},{"key":20,"filter":{"slotKey":-1,"signature":"onTimer(timerId)","args":[{"variable":"*"}]},"code":"unit:triggerEvent('onTimer',timerId)"},{"key":21,"filter":{"slotKey":-1,"signature":"onStart()","args":[]},"code":"\n\n-- DU-Logger-Viewer by tobitege, based on Jason Bloomer LUA scripts.\n-- Programming board script to display data on screen which is \n-- stored in a databank by the logger script.\n-- This is basically a wrapper around the actual, main script in viewer-main.lua\n\n-- First some setup code to allow debugging in VSCode\n---@diagnostic disable: param-type-mismatch\npackage.path = \"lua/?.lua;util/?.lua;\"..package.path\n\nrequire('DU-logger-viewer:globals.lua')\nConfig.core_required = false\n\nlocal status, err, _ = xpcall(function() require('DU-logger-viewer:startup.lua') end, traceback)\nif not status then\n    P(\"Error in startup!\")\n    if err then P(err) end\n    unit.exit()\n    return\nend\n\nDatabank = Config.databanks[1]\nScreen = Config.screens[1]\n\nlocal inp = require('DU-logger-viewer:viewer-screen.OnOutputChanged.lua')\nif inp ~= nil then\n    Screen:onEvent('OnOutputChanged', function (self, text) inp.Run(text) end)\nend\n\nstatus, err, _ = xpcall(function() require('DU-logger-viewer:viewer-main.lua') end, traceback)\nif not status then\n    P(\"Error in viewer-main!\")\n    if err then P(err) end\n    unit.exit()\nend"}],"events":[],"methods":[]}